# Tasks_251119_06.md
# 해양레저스포츠 자율신고 MVP - Task 6: 대시보드 및 응급 기능

**Push 단위**: 대시보드 및 응급 기능 완료  
**목표**: 사용자 대시보드, 신고 이력, 응급신고 버튼  
**배포 가능 여부**: ✅ 사용자가 과거 신고를 확인하고 응급상황에 대응 가능한 상태

---

## 관련 파일
- `src/app/dashboard/page.tsx` - 사용자 대시보드
- `src/components/dashboard/ReportHistory.tsx` - 신고 이력 컴포넌트
- `src/components/dashboard/RealtimeAlerts.tsx` - 실시간 알림
- `src/components/dashboard/EmergencyButton.tsx` - 응급신고 버튼
- `src/components/dashboard/StatsSummary.tsx` - 통계 요약
- `src/app/api/emergency/route.ts` - 응급신고 API
- `src/lib/services/emergencyService.ts` - 응급 서비스 로직
- `src/components/safety/EmergencyContacts.tsx` - 응급연락처

---

## 작업

- [ ] 6.0 대시보드 및 응급 기능 구현 (Push 단위)
    - [ ] 6.1 대시보드 레이아웃 구현 (커밋 단위)
        - [ ] 6.1.1 `src/app/dashboard/page.tsx` 생성
        - [ ] 6.1.2 인증 확인 (미들웨어로 보호)
        - [ ] 6.1.3 그리드 레이아웃 설정
            - [ ] 6.1.3.1 상단: 통계 카드 (총 신고 수, 최근 활동)
            - [ ] 6.1.3.2 중앙: 신고 이력 테이블
            - [ ] 6.1.3.3 사이드바: 실시간 알림, 응급 버튼
            - [ ] 6.1.3.4 테스트 코드 작성
            - [ ] 6.1.3.5 테스트 실행 및 검증
            - [ ] 6.1.3.6 오류 수정 (필요 시)
        - [ ] 6.1.4 반응형 디자인 (모바일/태블릿)
            - [ ] 6.1.4.1 테스트 코드 작성
            - [ ] 6.1.4.2 테스트 실행 및 검증
            - [ ] 6.1.4.3 오류 수정 (필요 시)

    - [ ] 6.2 통계 요약 컴포넌트 (커밋 단위)
        - [ ] 6.2.1 `src/components/dashboard/StatsSummary.tsx` 생성
        - [ ] 6.2.2 총 신고 수 카드
        - [ ] 6.2.3 이번 주 활동 카드
        - [ ] 6.2.4 안전도 평균 카드
        - [ ] 6.2.5 Supabase 집계 쿼리
            - [ ] 6.2.5.1 COUNT, AVG 사용
            - [ ] 6.2.5.2 테스트 코드 작성
            - [ ] 6.2.5.3 테스트 실행 및 검증
            - [ ] 6.2.5.4 오류 수정 (필요 시)
        - [ ] 6.2.6 로딩 상태 처리
            - [ ] 6.2.6.1 테스트 코드 작성
            - [ ] 6.2.6.2 테스트 실행 및 검증
            - [ ] 6.2.6.3 오류 수정 (필요 시)

    - [ ] 6.3 신고 이력 컴포넌트 (커밋 단위)
        - [ ] 6.3.1 `src/components/dashboard/ReportHistory.tsx` 생성
        - [ ] 6.3.2 테이블 형식으로 신고 목록 표시
            - [ ] 6.3.2.1 컬럼: 신고 ID, 날짜, 위치, 활동, 상태, 안전도
            - [ ] 6.3.2.2 정렬 기능 (날짜순, 안전도순)
            - [ ] 6.3.2.3 페이지네이션 (10개씩)
            - [ ] 6.3.2.4 테스트 코드 작성
            - [ ] 6.3.2.5 테스트 실행 및 검증
            - [ ] 6.3.2.6 오류 수정 (필요 시)
        - [ ] 6.3.3 신고 클릭 시 상세 페이지 이동
            - [ ] 6.3.3.1 테스트 코드 작성
            - [ ] 6.3.3.2 테스트 실행 및 검증
            - [ ] 6.3.3.3 오류 수정 (필요 시)
        - [ ] 6.3.4 필터링 기능 (상태별, 날짜별)
            - [ ] 6.3.4.1 테스트 코드 작성
            - [ ] 6.3.4.2 테스트 실행 및 검증
            - [ ] 6.3.4.3 오류 수정 (필요 시)

    - [ ] 6.4 실시간 알림 사이드바 (커밋 단위)
        - [ ] 6.4.1 `src/components/dashboard/RealtimeAlerts.tsx` 수정
        - [ ] 6.4.2 최근 알림 목록 표시 (최대 10개)
        - [ ] 6.4.3 알림 타입별 아이콘
            - [ ] 6.4.3.1 신규 신고
            - [ ] 6.4.3.2 상태 변경
            - [ ] 6.4.3.3 안전 경고
            - [ ] 6.4.3.4 테스트 코드 작성
            - [ ] 6.4.3.5 테스트 실행 및 검증
            - [ ] 6.4.3.6 오류 수정 (필요 시)
        - [ ] 6.4.4 "모두 읽음" 기능
            - [ ] 6.4.4.1 테스트 코드 작성
            - [ ] 6.4.4.2 테스트 실행 및 검증
            - [ ] 6.4.4.3 오류 수정 (필요 시)

    - [ ] 6.5 응급신고 버튼 구현 (커밋 단위)
        - [ ] 6.5.1 `src/components/dashboard/EmergencyButton.tsx` 생성
        - [ ] 6.5.2 큰 빨간 버튼 디자인
        - [ ] 6.5.3 클릭 시 확인 모달 표시
        - [ ] 6.5.4 현재 위치 자동 전송
            - [ ] 6.5.4.1 Geolocation API 호출
            - [ ] 6.5.4.2 테스트 코드 작성
            - [ ] 6.5.4.3 테스트 실행 및 검증
            - [ ] 6.5.4.4 오류 수정 (필요 시)
        - [ ] 6.5.5 응급신고 API 호출
            - [ ] 6.5.5.1 테스트 코드 작성
            - [ ] 6.5.5.2 테스트 실행 및 검증
            - [ ] 6.5.5.3 오류 수정 (필요 시)

    - [ ] 6.6 응급신고 API 구현 (커밋 단위)
        - [ ] 6.6.1 `src/app/api/emergency/route.ts` 생성
        - [ ] 6.6.2 POST 핸들러
            - [ ] 6.6.2.1 사용자 인증 확인
            - [ ] 6.6.2.2 위치 정보 수신
            - [ ] 6.6.2.3 Supabase에 응급신고 저장 (reports 테이블, status: 'EMERGENCY')
            - [ ] 6.6.2.4 알림 전송 (관리자, 해양경찰 시스템 연동 준비)
            - [ ] 6.6.2.5 테스트 코드 작성
            - [ ] 6.6.2.6 테스트 실행 및 검증
            - [ ] 6.6.2.7 오류 수정 (필요 시)

    - [ ] 6.7 응급연락처 컴포넌트 (커밋 단위)
        - [ ] 6.7.1 `src/components/safety/EmergencyContacts.tsx` 생성
        - [ ] 6.7.2 응급연락처 목록 표시
            - [ ] 6.7.2.1 해양경찰 122
            - [ ] 6.7.2.2 119 소방서
            - [ ] 6.7.2.3 지역 관청 (사용자 위치 기반)
            - [ ] 6.7.2.4 테스트 코드 작성
            - [ ] 6.7.2.5 테스트 실행 및 검증
            - [ ] 6.7.2.6 오류 수정 (필요 시)
        - [ ] 6.7.3 원클릭 전화 걸기 (tel: 링크)
            - [ ] 6.7.3.1 테스트 코드 작성
            - [ ] 6.7.3.2 테스트 실행 및 검증
            - [ ] 6.7.3.3 오류 수정 (필요 시)

    - [ ] 6.8 대시보드 데이터 캐싱 및 최적화 (커밋 단위)
        - [ ] 6.8.1 React Query 사용하여 데이터 캐싱
        - [ ] 6.8.2 staleTime, cacheTime 설정
        - [ ] 6.8.3 낙관적 업데이트 구현
        - [ ] 6.8.4 테스트 코드 작성: 캐싱 동작 확인
        - [ ] 6.8.5 테스트 실행 및 검증
        - [ ] 6.8.6 오류 수정 (필요 시)

    - [ ] 6.9 대시보드 접근 권한 테스트 (커밋 단위)
        - [ ] 6.9.1 비인증 사용자 접근 시 로그인 페이지로 리다이렉트 확인
        - [ ] 6.9.2 RLS 정책으로 타 사용자 데이터 접근 차단 확인
        - [ ] 6.9.3 테스트 코드 작성
        - [ ] 6.9.4 테스트 실행 및 검증
        - [ ] 6.9.5 오류 수정 (필요 시)

    - [ ] 6.10 E2E 테스트: 대시보드 플로우 (커밋 단위)
        - [ ] 6.10.1 `__tests__/e2e/dashboard.spec.ts` 생성
        - [ ] 6.10.2 Playwright 테스트
            - [ ] 6.10.2.1 로그인
            - [ ] 6.10.2.2 대시보드 접근
            - [ ] 6.10.2.3 통계 카드 확인
            - [ ] 6.10.2.4 신고 이력 테이블 확인
            - [ ] 6.10.2.5 응급 버튼 클릭 테스트
            - [ ] 6.10.2.6 테스트 실행
            - [ ] 6.10.2.7 오류 수정 (필요 시)

---

## 완료 조건
- [x] 대시보드 레이아웃 구현
- [x] 통계 요약 카드
- [x] 신고 이력 테이블 (정렬, 페이지네이션, 필터링)
- [x] 실시간 알림 사이드바
- [x] 응급신고 버튼 및 API
- [x] 응급연락처 컴포넌트
- [x] React Query 캐싱
- [x] E2E 테스트 통과

---

## Git 작업 흐름
```
6.1 커밋 → 6.2 커밋 → ... → 6.10 커밋
                ↓
          Task 6 Push (대시보드 기능 배포 가능)
```
