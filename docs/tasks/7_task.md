# Tasks_251119_07.md
# 해양레저스포츠 자율신고 MVP - Task 7: 테스트 및 최적화

**Push 단위**: 프로덕션 배포 준비 완료  
**목표**: E2E 테스트, 성능 최적화, Lighthouse 점수 개선  
**배포 가능 여부**: ✅ 프로덕션 배포 준비 완료

---

## 관련 파일
- `playwright.config.ts` - Playwright 설정
- `jest.config.js` - Jest 설정
- `__tests__/e2e/` - E2E 테스트 파일들
- `__tests__/components/` - 컴포넌트 테스트
- `__tests__/api/` - API 테스트
- `.github/workflows/ci.yml` - CI/CD 파이프라인
- `next.config.js` - 성능 최적화 설정
- `docs/DEPLOYMENT.md` - 배포 가이드

---

## 작업

- [ ] 7.0 테스트, 최적화 및 프로덕션 배포 (Push 단위)
    - [ ] 7.1 단위 테스트 보강 (커밋 단위)
        - [ ] 7.1.1 `__tests__/utils/validators.test.ts` - 검증 함수 테스트
        - [ ] 7.1.2 `__tests__/services/reportService.test.ts` - 신고 서비스 테스트
        - [ ] 7.1.3 `__tests__/services/safetyService.test.ts` - 안전도 서비스 테스트
        - [ ] 7.1.4 테스트 커버리지 80% 이상 달성
            - [ ] 7.1.4.1 테스트 실행: `npm run test:coverage`
            - [ ] 7.1.4.2 커버리지 리포트 확인
            - [ ] 7.1.4.3 오류 수정 (필요 시)

    - [ ] 7.2 컴포넌트 테스트 보강 (커밋 단위)
        - [ ] 7.2.1 `__tests__/components/ReportForm.test.tsx`
            - [ ] 7.2.1.1 폼 렌더링 테스트
            - [ ] 7.2.1.2 입력 검증 테스트
            - [ ] 7.2.1.3 제출 동작 테스트
            - [ ] 7.2.1.4 테스트 실행
            - [ ] 7.2.1.5 오류 수정 (필요 시)
        - [ ] 7.2.2 `__tests__/components/MapView.test.tsx`
            - [ ] 7.2.2.1 지도 렌더링 테스트
            - [ ] 7.2.2.2 마커 표시 테스트
            - [ ] 7.2.2.3 테스트 실행
            - [ ] 7.2.2.4 오류 수정 (필요 시)
        - [ ] 7.2.3 `__tests__/components/SafetyAnalysis.test.tsx`
            - [ ] 7.2.3.1 안전도 점수 렌더링 테스트
            - [ ] 7.2.3.2 색상 코드 테스트
            - [ ] 7.2.3.3 테스트 실행
            - [ ] 7.2.3.4 오류 수정 (필요 시)

    - [ ] 7.3 API 통합 테스트 (커밋 단위)
        - [ ] 7.3.1 `__tests__/api/report.test.ts`
            - [ ] 7.3.1.1 신고 제출 API 테스트
            - [ ] 7.3.1.2 신고 조회 API 테스트
            - [ ] 7.3.1.3 인증 에러 테스트
            - [ ] 7.3.1.4 테스트 실행
            - [ ] 7.3.1.5 오류 수정 (필요 시)
        - [ ] 7.3.2 `__tests__/api/safety.test.ts`
            - [ ] 7.3.2.1 안전구역 API 테스트
            - [ ] 7.3.2.2 테스트 실행
            - [ ] 7.3.2.3 오류 수정 (필요 시)

    - [ ] 7.4 E2E 테스트 완성 (커밋 단위)
        - [ ] 7.4.1 전체 사용자 플로우 테스트
            - [ ] 7.4.1.1 회원가입 → 로그인 → 신고 제출 → 결과 확인 → 대시보드
            - [ ] 7.4.1.2 테스트 실행: `npx playwright test`
            - [ ] 7.4.1.3 오류 수정 (필요 시)
        - [ ] 7.4.2 오프라인 시나리오 테스트
        - [ ] 7.4.3 실시간 알림 테스트
        - [ ] 7.4.4 응급신고 플로우 테스트
            - [ ] 7.4.4.1 테스트 실행
            - [ ] 7.4.4.2 오류 수정 (필요 시)

    - [ ] 7.5 성능 최적화 (커밋 단위)
        - [ ] 7.5.1 이미지 최적화
            - [ ] 7.5.1.1 Next.js Image 컴포넌트 사용
            - [ ] 7.5.1.2 WebP 포맷 변환
            - [ ] 7.5.1.3 lazy loading 적용
            - [ ] 7.5.1.4 테스트 실행: Lighthouse 이미지 점수 확인
            - [ ] 7.5.1.5 오류 수정 (필요 시)
        - [ ] 7.5.2 번들 크기 최적화
            - [ ] 7.5.2.1 `next.config.js`에 코드 스플리팅 설정
            - [ ] 7.5.2.2 Tree shaking 확인
            - [ ] 7.5.2.3 Dynamic import 적용 (지도, 차트 등)
            - [ ] 7.5.2.4 번들 분석: `npm run analyze`
            - [ ] 7.5.2.5 오류 수정 (필요 시)
        - [ ] 7.5.3 데이터베이스 쿼리 최적화
            - [ ] 7.5.3.1 인덱스 추가 (reports.user_id, reports.created_at)
            - [ ] 7.5.3.2 N+1 쿼리 제거
            - [ ] 7.5.3.3 Supabase 쿼리 플랜 확인
            - [ ] 7.5.3.4 테스트 실행
            - [ ] 7.5.3.5 오류 수정 (필요 시)

    - [ ] 7.6 Lighthouse 점수 최적화 (커밋 단위)
        - [ ] 7.6.1 Performance 점수 90+ 달성
            - [ ] 7.6.1.1 FCP (First Contentful Paint) 개선
            - [ ] 7.6.1.2 LCP (Largest Contentful Paint) 개선
            - [ ] 7.6.1.3 CLS (Cumulative Layout Shift) 개선
            - [ ] 7.6.1.4 Lighthouse 실행 및 확인
            - [ ] 7.6.1.5 오류 수정 (필요 시)
        - [ ] 7.6.2 Accessibility 점수 100 달성
            - [ ] 7.6.2.1 ARIA 레이블 추가
            - [ ] 7.6.2.2 키보드 네비게이션 지원
            - [ ] 7.6.2.3 색상 대비 확인
            - [ ] 7.6.2.4 Lighthouse 실행 및 확인
            - [ ] 7.6.2.5 오류 수정 (필요 시)
        - [ ] 7.6.3 Best Practices 점수 100 달성
        - [ ] 7.6.4 SEO 점수 100 달성
            - [ ] 7.6.4.1 메타 태그 최적화
            - [ ] 7.6.4.2 robots.txt 생성
            - [ ] 7.6.4.3 sitemap.xml 생성
            - [ ] 7.6.4.4 Lighthouse 실행 및 확인
            - [ ] 7.6.4.5 오류 수정 (필요 시)

    - [ ] 7.7 보안 강화 (커밋 단위)
        - [ ] 7.7.1 환경 변수 검증
            - [ ] 7.7.1.1 서버 전용 키가 클라이언트에 노출되지 않는지 확인
            - [ ] 7.7.1.2 테스트 코드 작성
            - [ ] 7.7.1.3 테스트 실행
            - [ ] 7.7.1.4 오류 수정 (필요 시)
        - [ ] 7.7.2 RLS 정책 재검증
            - [ ] 7.7.2.1 모든 테이블에 RLS 활성화 확인
            - [ ] 7.7.2.2 타 사용자 데이터 접근 차단 테스트
            - [ ] 7.7.2.3 오류 수정 (필요 시)
        - [ ] 7.7.3 CSRF 보호 (Next.js 기본 제공)
        - [ ] 7.7.4 XSS 방지 (입력 검증 및 sanitization)
            - [ ] 7.7.4.1 테스트 코드 작성
            - [ ] 7.7.4.2 테스트 실행
            - [ ] 7.7.4.3 오류 수정 (필요 시)

    - [ ] 7.8 에러 추적 및 모니터링 설정 (커밋 단위)
        - [ ] 7.8.1 Vercel Analytics 활성화
        - [ ] 7.8.2 에러 바운더리 추가 (React Error Boundary)
        - [ ] 7.8.3 전역 에러 핸들러 구현
        - [ ] 7.8.4 테스트 코드 작성
        - [ ] 7.8.5 테스트 실행
        - [ ] 7.8.6 오류 수정 (필요 시)

    - [ ] 7.9 문서화 (커밋 단위)
        - [ ] 7.9.1 `docs/API.md` - API 문서 작성
        - [ ] 7.9.2 `docs/DEPLOYMENT.md` - 배포 가이드 작성
            - [ ] 7.9.2.1 Vercel 배포 단계
            - [ ] 7.9.2.2 Supabase 설정 단계
            - [ ] 7.9.2.3 환경 변수 설정 방법
        - [ ] 7.9.3 `docs/CONTRIBUTING.md` - 기여 가이드 작성
        - [ ] 7.9.4 README 업데이트
            - [ ] 7.9.4.1 프로젝트 스크린샷 추가
            - [ ] 7.9.4.2 주요 기능 설명
            - [ ] 7.9.4.3 라이선스 추가

    - [ ] 7.10 최종 프로덕션 배포 (커밋 단위)
        - [ ] 7.10.1 모든 테스트 통과 확인
        - [ ] 7.10.2 Supabase 프로덕션 마이그레이션 적용
        - [ ] 7.10.3 Vercel 프로덕션 환경 변수 최종 확인
        - [ ] 7.10.4 main 브랜치에 머지 및 배포
        - [ ] 7.10.5 배포 후 스모크 테스트
            - [ ] 7.10.5.1 회원가입/로그인
            - [ ] 7.10.5.2 신고 제출
            - [ ] 7.10.5.3 지도 렌더링
            - [ ] 7.10.5.4 대시보드 접근
            - [ ] 7.10.5.5 오프라인 기능
        - [ ] 7.10.6 Lighthouse 최종 점수 측정 및 기록
        - [ ] 7.10.7 배포 URL 및 문서 공유

---

## 완료 조건
- [x] 단위 테스트 커버리지 80% 이상
- [x] 컴포넌트 테스트 완료
- [x] API 통합 테스트 완료
- [x] E2E 테스트 전체 플로우 통과
- [x] 성능 최적화 (이미지, 번들, 쿼리)
- [x] Lighthouse 점수: Performance 90+, Accessibility 100, Best Practices 100, SEO 100
- [x] 보안 검증 완료
- [x] 문서화 완료
- [x] 프로덕션 배포 성공

---

## Git 작업 흐름
```
7.1 커밋 → 7.2 커밋 → ... → 7.10 커밋
                ↓
          Task 7 Push (프로덕션 배포 완료!)
```

---

## 🎉 프로젝트 완료!
모든 작업이 완료되면 해양레저스포츠 AI 기반 자율신고제도 MVP가 프로덕션 환경에서 실행됩니다.
